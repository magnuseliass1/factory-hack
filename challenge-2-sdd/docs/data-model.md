# Data Model: Intelligent Repair Planner Agent

**Feature**: 001-repair-planner-agent  
**Phase**: 1 - Design  
**Date**: 2026-01-13

## Entity Overview

The Repair Planner Agent manages four core entities that represent the flow from fault detection to work order completion. These entities are designed for Cosmos DB storage with appropriate partitioning and indexing strategies.

## Core Entities

### DiagnosedFault

Represents a fault detected by the upstream diagnostic system, serving as input to the repair planning process.

**Attributes**:
- `Id` (string): Unique fault identifier (GUID)
- `EquipmentId` (string): Manufacturing equipment identifier  
- `FaultType` (string): Categorized fault type (mechanical, electrical, hydraulic, pneumatic)
- `Severity` (enum): Critical, High, Medium, Low
- `DetectedAt` (DateTime): UTC timestamp when fault was detected
- `Symptoms` (List<string>): Observable symptoms and error codes
- `Location` (Location): Physical location details
- `DiagnosticData` (Dictionary<string, object>): Raw sensor data and diagnostic details
- `EstimatedImpact` (string): Production impact assessment
- `RequiredSkills` (List<string>): Initial skill requirements derived from fault type

**Relationships**:
- One DiagnosedFault generates one WorkOrder
- References Equipment entity (external system)

**Validation Rules**:
- FaultType must be from predefined enumeration
- DetectedAt cannot be future date
- RequiredSkills derived from fault type mapping rules

### Technician

Represents a maintenance technician with skills, certifications, and availability information.

**Attributes**:
- `Id` (string): Employee identifier
- `Name` (string): Full name
- `Skills` (List<Skill>): Technical competencies and proficiency levels
- `Certifications` (List<Certification>): Active certifications with expiry dates
- `ShiftSchedule` (ShiftSchedule): Working hours and availability
- `CurrentLocation` (Location): Current physical location
- `CurrentWorkload` (int): Number of active assignments
- `MaxConcurrentTasks` (int): Maximum parallel work capacity
- `ContactInfo` (ContactInfo): Phone, radio, email details

**Sub-entities**:
- `Skill`: Name, ProficiencyLevel (Novice/Intermediate/Expert), YearsExperience
- `Certification`: Name, Number, ExpiryDate, IssuingBody
- `ShiftSchedule`: StartTime, EndTime, DaysOfWeek, TimeZone

**Relationships**:
- One Technician can be assigned to multiple WorkOrders
- Technician skills match WorkOrder task requirements

**Validation Rules**:
- Skill proficiency levels must align with task complexity requirements
- Certifications must be current (not expired)
- Workload cannot exceed MaxConcurrentTasks

### Part

Represents inventory items required for equipment repairs.

**Attributes**:
- `Id` (string): Part number (manufacturer standard)
- `Name` (string): Descriptive part name
- `Category` (string): Part classification (mechanical, electrical, consumable)
- `Specifications` (Dictionary<string, string>): Technical specifications
- `CompatibleEquipment` (List<string>): Equipment models that use this part
- `Supplier` (Supplier): Primary supplier information
- `Inventory` (InventoryInfo): Stock levels and location details
- `LeadTime` (TimeSpan): Standard procurement time
- `Cost` (decimal): Standard cost per unit
- `SafetyStock` (int): Minimum inventory threshold

**Sub-entities**:
- `Supplier`: Name, ContactInfo, ReliabilityRating
- `InventoryInfo`: QuantityAvailable, ReservedQuantity, WarehouseLocation, LastUpdated

**Relationships**:
- Parts are consumed by WorkOrder tasks
- Multiple Parts may be required for a single fault repair

**Validation Rules**:
- QuantityAvailable must be >= ReservedQuantity
- LeadTime must be positive
- SafetyStock alerts trigger when QuantityAvailable falls below threshold

### WorkOrder

Represents a structured repair plan generated by the system, containing tasks, resource assignments, and execution details.

**Attributes**:
- `Id` (string): Work order number (auto-generated)
- `FaultId` (string): Reference to originating DiagnosedFault
- `Status` (enum): Created, Scheduled, InProgress, Completed, Cancelled
- `Priority` (enum): Emergency, High, Normal, Low (derived from fault severity)
- `CreatedAt` (DateTime): Work order creation timestamp
- `ScheduledStartTime` (DateTime?): Planned maintenance window start
- `EstimatedDuration` (TimeSpan): Total estimated completion time
- `AssignedTechnician` (string): Primary technician assignment
- `BackupTechnicians` (List<string>): Alternative technician options
- `Tasks` (List<RepairTask>): Ordered sequence of repair activities
- `RequiredParts` (List<PartRequirement>): Parts needed with quantities
- `SafetyProcedures` (List<string>): Required safety protocols
- `CompletionNotes` (string): Post-completion observations
- `ActualDuration` (TimeSpan?): Actual time taken for completion

**Sub-entities**:
- `RepairTask`: Id, Description, EstimatedTime, RequiredSkills, Prerequisites, Status
- `PartRequirement`: PartId, QuantityNeeded, Reserved, AllocatedFrom

**Relationships**:
- One WorkOrder corresponds to one DiagnosedFault
- WorkOrder references assigned Technician
- WorkOrder contains multiple PartRequirements

**State Transitions**:
- Created → Scheduled (when technician assigned and parts available)
- Scheduled → InProgress (when work begins)
- InProgress → Completed (when all tasks finished)
- Any status → Cancelled (if circumstances change)

**Validation Rules**:
- EstimatedDuration must equal sum of RepairTask times
- ScheduledStartTime must account for technician availability
- Required parts must be available or have acceptable lead times

## Entity Relationships

```
DiagnosedFault (1) → (1) WorkOrder
Technician (1) → (0..*) WorkOrder
Part (1) → (0..*) PartRequirement
WorkOrder (1) → (0..*) PartRequirement
WorkOrder (1) → (1..*) RepairTask
```

## Cosmos DB Design Considerations

### Partitioning Strategy
- DiagnosedFault: Partition by EquipmentId for equipment-based queries
- Technician: Partition by ShiftSchedule.TimeZone for location-based optimization  
- Part: Partition by Category for inventory management queries
- WorkOrder: Partition by Status for operational dashboard efficiency

### Indexing Strategy
- DiagnosedFault: Index on DetectedAt, Severity, FaultType
- Technician: Index on Skills.Name, CurrentLocation, ShiftSchedule
- Part: Index on CompatibleEquipment, Category, Inventory.QuantityAvailable
- WorkOrder: Index on Priority, ScheduledStartTime, AssignedTechnician

### Data Consistency
- Strong consistency for WorkOrder creation and updates
- Eventual consistency acceptable for Technician availability updates
- Strong consistency required for Part inventory reservations